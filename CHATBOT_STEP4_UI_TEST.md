# チャットボット実装手順 (ステップ4)

このドキュメントでは、動物病院向け LINE チャットボット＋予約システムにおける **開発手順ステップ4 : UI テスト** を説明します。ステップ3までで予約 API (MCP Server) の実装が完了している前提です。

## 1. テスト準備
1. LINE 公式アカウントを自分の LINE で友だち追加し、Webhook が応答するか確認します。
2. `ENVIRONMENT_SETUP.md` の手順に従い、Apps Script プロジェクトと Sheets の初期設定が完了していることを確かめます。
3. テストで使用する Google Sheets (`slots`・`reservations`・`logs`) が最新の状態であるか確認します。

## 2. 基本的な予約シナリオ
1. LINE から予約希望日を送信し、`listSlots` の結果が正しく返るかを確認します。
2. 空き枠を指定して `createBooking` を実行し、`reservations` シートに行が追加されるかチェックします。
3. 対応する `slots` 行の `reserved` がインクリメントされ、`logs` シートにも履歴が残ることを確かめます。

## 3. キャンセル・変更の確認
1. 既存の予約に対して `cancelBooking` を実行し、ステータスが `cancelled` に更新されるか確認します。
2. `updateBooking` で別枠へ変更し、旧枠の開放と新枠の確保が正しく行われるかをチェックします。

## 4. エラーパターン検証
1. 予約枠が空いていない時間を指定して予約し、`SlotUnavailable` エラーが返るか試します。
2. パラメーター不足や無効な日付フォーマットなどを送信し、`InvalidParams` エラーが適切に返るか確認します。
3. Webhook 応答が 10 秒以内に返るか、処理時間も併せて記録します。

## 5. 複数ユーザーでのテスト
1. 家族や友人に協力してもらい、同時に予約・キャンセル操作を行って競合が発生しないか確認します。
2. シートへの書き込み衝突が起きないよう `LockService` が機能しているかをチェックします。

## 6. ログとデータ整合性
1. すべての操作が `logs` シートに時系列で記録されているかを確認します。
2. 手動編集による不整合がないか、シートの保護設定や共有権限も見直します。

## 7. バッチ処理との併用確認
1. `slots` 生成バッチ（毎日 0 時トリガー）実行後でも、新規予約・キャンセルが問題なく行えるかテストします。
2. バッチ処理が既存予約を上書きしないか、`slots` と `reservations` の整合性を確認します。

---
以上がステップ4「UI テスト」の作業手順です。LINE 上での一連の予約操作を実際に試行し、Sheets へのデータ保存とログ記録を詳細に検証することで、後続フェーズへ進むための品質を確保できます。
