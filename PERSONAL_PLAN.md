# 個人開発者向け 仮要件・実装計画

本ドキュメントは、README に基づく動物病院向け LINE チャットボット＋予約システムを、個人開発者レベルで実装する際の簡易要件と作業計画を示します。

## 1. 目的
- 電話対応負荷を減らし、飼い主が LINE 上で 24 時間予約・相談できる環境を実現する。
- 最小限の構成で早期にプロトタイプを完成させ、運用を試行する。

## 2. スコープ
- 1 拠点の動物病院を対象とし、基本機能のみを実装。
- 機能追加や多拠点展開は将来の拡張項目として扱う。

## 3. 使用技術
- **LINE チャネル**: LINE Messaging API
- **チャットボット実装**: Google Apps Script (V8)
- **予約 API (MCP Server)**: Google Apps Script の Web アプリとして実装
- **データストア**: Google Sheets
- **LLM API**: OpenAI GPT-4o

## 4. 機能要件 (最小構成)
1. **質問回答**: ユーザーからのメッセージを受け取り、GPT-4o で回答しログを残す。
2. **予約インテント抽出**: プロンプト内で JSON `{date,time,petInfo}` を抽出。
3. **予約枠一覧取得 (`listSlots`)**: 指定日の空き枠を Sheets から取得し返却。
4. **予約作成 (`createBooking`)**: ユーザー情報を保存し予約を確定。
5. **予約キャンセル (`cancelBooking`)**: 予約を取り消し枠を解放。
6. **日次バッチ**: 翌 30 日分の予約枠を作成するトリガー。

## 5. 非機能要件 (簡易版)
- Webhook 受信後 10 秒以内に応答。
- Sheets は編集履歴でバックアップ。定期的に Drive へエクスポート。
- 認証は Bearer トークンのみ。OAuth2 は不要。
- 可用性は自宅開発環境の範囲で 90%以上を目標とする。

## 6. 作業ステップ
1. **環境準備**: LINE 公式アカウント作成、Apps Script プロジェクト作成、Sheets 用意。
2. **チャットボットの基本実装**: Webhook ハンドラ、GPT-4o API 呼び出し、ログ保存。
3. **予約 API (MCP Server) の実装**: `listSlots`・`createBooking`・`cancelBooking` のエンドポイント作成。
4. **UI テスト**: 自身の LINE で動作確認し、予約データが Sheets に保存されることを確認。
5. **バッチ処理追加**: 毎日 0 時に翌 30 日分の `slots` を再生成するトリガー設定。
6. **簡易マニュアル作成**: 使い方と運用上の注意点を README へ追記。

## 7. スケジュール例
| フェーズ | 期間 | 主な作業 |
| --- | --- | --- |
| 要件整理 | 1 日 | 本ドキュメント作成・LINE 設定 | 
| 実装 | 5 日 | Apps Script コーディング | 
| テスト | 2 日 | 自身および家族・友人による動作確認 | 
| リリース | 1 日 | 簡易マニュアルを添えて試験運用開始 |

## 8. リスクと対策
- **Apps Script クォータ不足**: 大量利用が見込まれたら早期に GCP への移行を検討する。
- **LLM 料金高騰**: 月次の API 利用量を確認し必要なら呼び出し頻度を制限する。
- **バグによるデータ消失**: Sheets のバージョン履歴で復旧できるよう定期的にバックアップを取得。

---
以上
